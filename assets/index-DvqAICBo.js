(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();function c(i,t){this.x=i,this.y=t}c.prototype={clone(){return new c(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,t){return this.clone()._rotateAround(i,t)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const t=i.x-this.x,e=i.y-this.y;return t*t+e*e},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult(i){const t=i[0]*this.x+i[1]*this.y,e=i[2]*this.x+i[3]*this.y;return this.x=t,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const t=Math.cos(i),e=Math.sin(i),r=t*this.x-e*this.y,s=e*this.x+t*this.y;return this.x=r,this.y=s,this},_rotateAround(i,t){const e=Math.cos(i),r=Math.sin(i),s=t.x+e*(this.x-t.x)-r*(this.y-t.y),n=t.y+r*(this.x-t.x)+e*(this.y-t.y);return this.x=s,this.y=n,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:c};c.convert=function(i){if(i instanceof c)return i;if(Array.isArray(i))return new c(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new c(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};class B{constructor(t,e,r,s,n){this.properties={},this.extent=r,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=n,t.readFields(E,this,e)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos,r=[];let s,n=1,o=0,a=0,h=0;for(;t.pos<e;){if(o<=0){const d=t.readVarint();n=d&7,o=d>>3}if(o--,n===1||n===2)a+=t.readSVarint(),h+=t.readSVarint(),n===1&&(s&&r.push(s),s=[]),s&&s.push(new c(a,h));else if(n===7)s&&s.push(s[0].clone());else throw new Error(`unknown command ${n}`)}return s&&r.push(s),r}bbox(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let r=1,s=0,n=0,o=0,a=1/0,h=-1/0,d=1/0,u=-1/0;for(;t.pos<e;){if(s<=0){const w=t.readVarint();r=w&7,s=w>>3}if(s--,r===1||r===2)n+=t.readSVarint(),o+=t.readSVarint(),n<a&&(a=n),n>h&&(h=n),o<d&&(d=o),o>u&&(u=o);else if(r!==7)throw new Error(`unknown command ${r}`)}return[a,d,h,u]}toGeoJSON(t,e,r){const s=this.extent*Math.pow(2,r),n=this.extent*t,o=this.extent*e,a=this.loadGeometry();function h(l){return[(l.x+n)*360/s-180,360/Math.PI*Math.atan(Math.exp((1-(l.y+o)*2/s)*Math.PI))-90]}function d(l){return l.map(h)}let u;if(this.type===1){const l=[];for(const g of a)l.push(g[0]);const x=d(l);u=l.length===1?{type:"Point",coordinates:x[0]}:{type:"MultiPoint",coordinates:x}}else if(this.type===2){const l=a.map(d);u=l.length===1?{type:"LineString",coordinates:l[0]}:{type:"MultiLineString",coordinates:l}}else if(this.type===3){const l=D(a),x=[];for(const g of l)x.push(g.map(d));u=x.length===1?{type:"Polygon",coordinates:x[0]}:{type:"MultiPolygon",coordinates:x}}else throw new Error("unknown feature type");const w={type:"Feature",geometry:u,properties:this.properties};return this.id!=null&&(w.id=this.id),w}}B.types=["Unknown","Point","LineString","Polygon"];function E(i,t,e){i===1?t.id=e.readVarint():i===2?M(e,t):i===3?t.type=e.readVarint():i===4&&(t._geometry=e.pos)}function M(i,t){const e=i.readVarint()+i.pos;for(;i.pos<e;){const r=t._keys[i.readVarint()],s=t._values[i.readVarint()];t.properties[r]=s}}function D(i){const t=i.length;if(t<=1)return[i];const e=[];let r,s;for(let n=0;n<t;n++){const o=T(i[n]);o!==0&&(s===void 0&&(s=o<0),s===o<0?(r&&e.push(r),r=[i[n]]):r&&r.push(i[n]))}return r&&e.push(r),e}function T(i){let t=0;for(let e=0,r=i.length,s=r-1,n,o;e<r;s=e++)n=i[e],o=i[s],t+=(o.x-n.x)*(n.y+o.y);return t}class I{constructor(t,e){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(L,this,e),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const e=this._pbf.readVarint()+this._pbf.pos;return new B(this._pbf,e,this.extent,this._keys,this._values)}}function L(i,t,e){i===15?t.version=e.readVarint():i===1?t.name=e.readString():i===5?t.extent=e.readVarint():i===2?t._features.push(e.pos):i===3?t._keys.push(e.readString()):i===4&&t._values.push(C(e))}function C(i){let t=null;const e=i.readVarint()+i.pos;for(;i.pos<e;){const r=i.readVarint()>>3;t=r===1?i.readString():r===2?i.readFloat():r===3?i.readDouble():r===4?i.readVarint64():r===5?i.readVarint():r===6?i.readSVarint():r===7?i.readBoolean():null}return t}class U{constructor(t,e){this.layers=t.readFields(b,{},e)}}function b(i,t,e){if(i===3){const r=new I(e,e.readVarint()+e.pos);r.length&&(t[r.name]=r)}}const m=65536*65536,_=1/m,N=12,S=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),V=0,p=1,y=2,F=5;class O{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,e,r=this.length){for(;this.pos<r;){const s=this.readVarint(),n=s>>3,o=this.pos;this.type=s&7,t(n,e,this),this.pos===o&&this.skip(s)}return e}readMessage(t,e){return this.readFields(t,e,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*m;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*m;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const e=this.buf;let r,s;return s=e[this.pos++],r=s&127,s<128||(s=e[this.pos++],r|=(s&127)<<7,s<128)||(s=e[this.pos++],r|=(s&127)<<14,s<128)||(s=e[this.pos++],r|=(s&127)<<21,s<128)?r:(s=e[this.pos],r|=(s&15)<<28,A(r,t,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2===1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=N&&S?S.decode(this.buf.subarray(e,t)):Y(this.buf,e,t)}readBytes(){const t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e}readPackedVarint(t=[],e){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readVarint(e));return t}readPackedSVarint(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===y?this.readVarint()+this.pos:this.pos+1}skip(t){const e=t&7;if(e===V)for(;this.buf[this.pos++]>127;);else if(e===y)this.pos=this.readVarint()+this.pos;else if(e===F)this.pos+=4;else if(e===p)this.pos+=8;else throw new Error(`Unimplemented type: ${e}`)}writeTag(t,e){this.writeVarint(t<<3|e)}realloc(t){let e=this.length||16;for(;e<this.pos+t;)e*=2;if(e!==this.length){const r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*_),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*_),!0),this.pos+=8}writeVarint(t){if(t=+t||0,t>268435455||t<0){R(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))}writeSVarint(t){this.writeVarint(t<0?-t*2-1:t*2)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(t.length*4),this.pos++;const e=this.pos;this.pos=Q(this.buf,t,this.pos);const r=this.pos-e;r>=128&&k(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const e=t.length;this.writeVarint(e),this.realloc(e);for(let r=0;r<e;r++)this.buf[this.pos++]=t[r]}writeRawMessage(t,e){this.pos++;const r=this.pos;t(e,this);const s=this.pos-r;s>=128&&k(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s}writeMessage(t,e,r){this.writeTag(t,y),this.writeRawMessage(e,r)}writePackedVarint(t,e){e.length&&this.writeMessage(t,j,e)}writePackedSVarint(t,e){e.length&&this.writeMessage(t,q,e)}writePackedBoolean(t,e){e.length&&this.writeMessage(t,W,e)}writePackedFloat(t,e){e.length&&this.writeMessage(t,H,e)}writePackedDouble(t,e){e.length&&this.writeMessage(t,J,e)}writePackedFixed32(t,e){e.length&&this.writeMessage(t,X,e)}writePackedSFixed32(t,e){e.length&&this.writeMessage(t,$,e)}writePackedFixed64(t,e){e.length&&this.writeMessage(t,z,e)}writePackedSFixed64(t,e){e.length&&this.writeMessage(t,K,e)}writeBytesField(t,e){this.writeTag(t,y),this.writeBytes(e)}writeFixed32Field(t,e){this.writeTag(t,F),this.writeFixed32(e)}writeSFixed32Field(t,e){this.writeTag(t,F),this.writeSFixed32(e)}writeFixed64Field(t,e){this.writeTag(t,p),this.writeFixed64(e)}writeSFixed64Field(t,e){this.writeTag(t,p),this.writeSFixed64(e)}writeVarintField(t,e){this.writeTag(t,V),this.writeVarint(e)}writeSVarintField(t,e){this.writeTag(t,V),this.writeSVarint(e)}writeStringField(t,e){this.writeTag(t,y),this.writeString(e)}writeFloatField(t,e){this.writeTag(t,F),this.writeFloat(e)}writeDoubleField(t,e){this.writeTag(t,p),this.writeDouble(e)}writeBooleanField(t,e){this.writeVarintField(t,+e)}}function A(i,t,e){const r=e.buf;let s,n;if(n=r[e.pos++],s=(n&112)>>4,n<128||(n=r[e.pos++],s|=(n&127)<<3,n<128)||(n=r[e.pos++],s|=(n&127)<<10,n<128)||(n=r[e.pos++],s|=(n&127)<<17,n<128)||(n=r[e.pos++],s|=(n&127)<<24,n<128)||(n=r[e.pos++],s|=(n&1)<<31,n<128))return f(i,s,t);throw new Error("Expected varint not more than 10 bytes")}function f(i,t,e){return e?t*4294967296+(i>>>0):(t>>>0)*4294967296+(i>>>0)}function R(i,t){let e,r;if(i>=0?(e=i%4294967296|0,r=i/4294967296|0):(e=~(-i%4294967296),r=~(-i/4294967296),e^4294967295?e=e+1|0:(e=0,r=r+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),v(e,r,t),G(r,t)}function v(i,t,e){e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos]=i&127}function G(i,t){const e=(i&7)<<4;t.buf[t.pos++]|=e|((i>>>=3)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127)))))}function k(i,t,e){const r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(r);for(let s=e.pos-1;s>=i;s--)e.buf[s+r]=e.buf[s]}function j(i,t){for(let e=0;e<i.length;e++)t.writeVarint(i[e])}function q(i,t){for(let e=0;e<i.length;e++)t.writeSVarint(i[e])}function H(i,t){for(let e=0;e<i.length;e++)t.writeFloat(i[e])}function J(i,t){for(let e=0;e<i.length;e++)t.writeDouble(i[e])}function W(i,t){for(let e=0;e<i.length;e++)t.writeBoolean(i[e])}function X(i,t){for(let e=0;e<i.length;e++)t.writeFixed32(i[e])}function $(i,t){for(let e=0;e<i.length;e++)t.writeSFixed32(i[e])}function z(i,t){for(let e=0;e<i.length;e++)t.writeFixed64(i[e])}function K(i,t){for(let e=0;e<i.length;e++)t.writeSFixed64(i[e])}function Y(i,t,e){let r="",s=t;for(;s<e;){const n=i[s];let o=null,a=n>239?4:n>223?3:n>191?2:1;if(s+a>e)break;let h,d,u;a===1?n<128&&(o=n):a===2?(h=i[s+1],(h&192)===128&&(o=(n&31)<<6|h&63,o<=127&&(o=null))):a===3?(h=i[s+1],d=i[s+2],(h&192)===128&&(d&192)===128&&(o=(n&15)<<12|(h&63)<<6|d&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(h=i[s+1],d=i[s+2],u=i[s+3],(h&192)===128&&(d&192)===128&&(u&192)===128&&(o=(n&15)<<18|(h&63)<<12|(d&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),s+=a}return r}function Q(i,t,e){for(let r=0,s,n;r<t.length;r++){if(s=t.charCodeAt(r),s>55295&&s<57344)if(n)if(s<56320){i[e++]=239,i[e++]=191,i[e++]=189,n=s;continue}else s=n-55296<<10|s-56320|65536,n=null;else{s>56319||r+1===t.length?(i[e++]=239,i[e++]=191,i[e++]=189):n=s;continue}else n&&(i[e++]=239,i[e++]=191,i[e++]=189,n=null);s<128?i[e++]=s:(s<2048?i[e++]=s>>6|192:(s<65536?i[e++]=s>>12|224:(i[e++]=s>>18|240,i[e++]=s>>12&63|128),i[e++]=s>>6&63|128),i[e++]=s&63|128)}return e}let P=null;document.getElementById("file-input").addEventListener("change",async i=>{const t=i.target.files[0];if(!t)return;const e=await t.arrayBuffer();let r;try{r=new U(new O(e))}catch{document.getElementById("output").textContent="⚠️ このファイルはMVT/PBF形式ではありません。",document.getElementById("download-btn").disabled=!0;return}const s={};for(const n in r.layers){const o=r.layers[n],a=[];for(let h=0;h<o.length;h++){const d=o.feature(h).toGeoJSON(0,0,0);a.push(d)}s[n]=a}P=s,document.getElementById("output").textContent=JSON.stringify(s,null,2),document.getElementById("download-btn").disabled=!1});document.getElementById("download-btn").addEventListener("click",()=>{if(!P)return;const i=new Blob([JSON.stringify(P,null,2)],{type:"application/json"}),t=URL.createObjectURL(i),e=document.createElement("a");e.href=t,e.download="tile.geojson",e.click(),URL.revokeObjectURL(t)});
